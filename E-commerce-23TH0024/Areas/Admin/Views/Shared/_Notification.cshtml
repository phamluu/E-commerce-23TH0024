<a class="nav-link dropdown-toggle waves-light waves-effect" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
    <i class="fe-bell noti-icon"></i>
    <span class="badge badge-danger rounded-circle noti-icon-badge">0</span>
</a>
<div class="dropdown-menu dropdown-menu-right dropdown-lg">
    <div class="dropdown-item noti-title">
        <h5 class="m-0 text-white">
            <span class="float-right">
                <a href="" class="text-white">
                    <small>Xóa tất cả</small>
                </a>
            </span>Thông báo
        </h5>
    </div>

    <div class="slimscroll noti-scroll" id="notification-list" style="height:auto !important ; max-height: 400px; overflow-y: auto; ">
        
    </div>
    <a href="javascript:void(0);" class="dropdown-item text-center text-primary notify-item notify-all">
        Xem tất cả
        <i class="fi-arrow-right"></i>
    </a>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
<script>
        $(".slimscroll").slimScroll({
        height: "400px", // hoặc giá trị bạn muốn
        position: "right",
        size: "8px",
        touchScrollStep: 20,
        color: "#9ea5ab"
    });

<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/taskHub")
        .build();

    let notiCount = 0;

    connection.on("ReceiveNotification", function (task) {
        notiCount++;
        document.getElementById("noti-count").innerText = notiCount;

        const html = `
            <a href="/Admin/Task/Details/${task.Id}" class="dropdown-item notify-item">
                <div class="notify-icon bg-primary">
                    <i class="mdi mdi-file-document-outline"></i>
                </div>
                <p class="notify-details">
                    ${task.Title}
                    <small class="text-muted">${task.Project ?? "Không có dự án"}</small>
                    <br />
                    
                </p>
            </a>
        `;
        document.getElementById("notification-list").insertAdjacentHTML("afterbegin", html);
    });

    connection.start().catch(err => console.error(err));

    // Xóa thông báo
    document.getElementById("clear-all").addEventListener("click", () => {
        document.getElementById("notification-list").innerHTML = "";
        document.getElementById("noti-count").innerText = "0";
        notiCount = 0;
        // Nếu muốn cập nhật DB: gọi Ajax để đánh dấu đã đọc
    });
</script>

<script>

    function loadNotifications() {
        $.get("/Admin/Notification/GetUnreadTasks", function (data) {
            let html = "";
            data.forEach(item => {
                html += `
                <a href="/Admin/Task/Details/${item.id}" class="dropdown-item notify-item">
                    <div class="notify-icon bg-primary">
                        <i class="mdi mdi-comment-account-outline"></i>
                    </div>
                    <p class="notify-details">
                        ${item.title}
                        <small class="text-muted">${item.title}</small>
                    </p>
                </a>`;
            });
            $(".noti-scroll").html(html);
            $(".noti-icon-badge").text(data.length);
        });
    }

    // Gọi khi load layout
    $(document).ready(function () {
        loadNotifications();

        // Gọi lại sau mỗi 30s (nếu muốn realtime hơn thì dùng SignalR)
        setInterval(loadNotifications, 30000);
    });
</script>
